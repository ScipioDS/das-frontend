<app-header></app-header>
<div class="container d-flex flex-column h-100 mt-5">
  <div class="d-flex align-items-center justify-content-between">
    <div class="d-flex align-content-center">
      <div class="h1 preknow-white me-1">{{name}}</div>
      @if (userLoggedIn){
        @if (isSaved) {
          <mat-icon
            style="color: #D03F1B; font-size: 2.5rem; cursor: pointer; width: 2.5rem; height: 2.5rem;"
            class="d-flex align-items-center justify-content-center"
            matTooltip="Remove saved"
            (click)="removeFromUser()"
          >
            check_circle
          </mat-icon>
        } @else {
          <mat-icon
            style="color: #D03F1B; font-size: 2.5rem; cursor: pointer; width: 2.5rem; height: 2.5rem;"
            class="d-flex align-items-center justify-content-center"
            matTooltip="Save crypto"
            (click)="saveToUser()"
          >
            add_circle
          </mat-icon>
        }
      }
    </div>
    <button
      class="btn btn-light"
      (click)="getFullReport()"
    >
      Get full report
    </button>
  </div>
  <div class="d-flex flex-wrap justify-content-between">
    <div class="preknow-white-bg rounded-3 w-45 d-flex flex-column justify-content-center align-items-center pk-card-container">
      <div class="h1 preknow-black mt-3 mb-5">Price History</div>
      <ngx-charts-line-chart
        [view]="view"
        [scheme]="colorScheme"
        [legend]="legend"
        [showXAxisLabel]="showXAxisLabel"
        [showYAxisLabel]="showYAxisLabel"
        [xAxis]="xAxis"
        [yAxis]="yAxis"
        [xAxisLabel]="xAxisLabel"
        [yAxisLabel]="yAxisLabel"
        [timeline]="timeline"
        [results]="multi"
        (select)="onSelect($event)"
        (activate)="onActivate($event)"
        (deactivate)="onDeactivate($event)"
      >
      </ngx-charts-line-chart>
    </div>
    <div class="preknow-white-bg rounded-3 w-45 d-flex flex-column justify-content-center align-items-center pk-card-container">
      @if (isLoading) {
        <mat-progress-spinner mode="indeterminate" color="accent"></mat-progress-spinner>
      } @else {
        <div class="w-100 h-100 p-4">
          <h2 class="preknow-black">Next Predicted Price:</h2>
          <h3 class="preknow-black">{{predictedPrice | currency:'USD':'symbol':'1.2-2'}}</h3>
          <mat-divider></mat-divider>
          <h2 class="preknow-black mt-3">Trend:</h2>
          <h3 class="preknow-black">Positive</h3>
          <mat-divider></mat-divider>
          <h2 class="preknow-black mt-3">Last Known Price:</h2>
          <h3 class="preknow-black">{{lastPrice | currency:'USD':'symbol':'1.2-2'}}</h3>
          <mat-divider></mat-divider>
          <div class="text-end">
            Powered by PreKnow AI
          </div>
        </div>
      }
    </div>
  </div>

  @if (isAdmin){
    <div class="d-flex flex-row mt-3">
      <button
        class="btn btn-danger ms-3"
      >
        Delete Crypto
      </button>

      <button
        class="btn btn-light ms-3"
      >
        Edit Crypto
      </button>
    </div>
  }
</div>
